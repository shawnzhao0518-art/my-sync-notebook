<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <title>我的同步记事本</title>
  <style>
    body { font-family: sans-serif; padding: 20px; }
    textarea { width: 100%; height: 200px; margin-top: 10px; }
    button { margin: 10px 0; padding: 10px 20px; }
    #status { margin-top: 10px; color: green; }
  </style>
</head>
<body>
  <h2>我的同步记事本</h2>

  <textarea id="note" placeholder="在这里写下你的笔记..."></textarea>
  <button id="saveBtn">保存笔记</button>
  <div id="status"></div>

  <script type="module">
    // 引入 Firebase 模块
    import { initializeApp } from "https://www.gstatic.com/firebasejs/12.3.0/firebase-app.js";
    import { getFirestore, doc, getDoc, setDoc, onSnapshot } 
      from "https://www.gstatic.com/firebasejs/12.3.0/firebase-firestore.js";

    // 你的 Firebase 配置
    const firebaseConfig = {
      apiKey: "AIzaSyAT4k8co1PBwThkZFVEjdvPD4N-DRSP_fI",
      authDomain: "my-sync-notebook-3d134.firebaseapp.com",
      projectId: "my-sync-notebook-3d134",
      storageBucket: "my-sync-notebook-3d134.appspot.com", // ✅ 已修正
      messagingSenderId: "554261227887",
      appId: "1:554261227887:web:aed7afa4314adf1fbc209a"
    };

    // 初始化 Firebase
    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    // 笔记元素
    const noteEl = document.getElementById("note");
    const statusEl = document.getElementById("status");
    const saveBtn = document.getElementById("saveBtn");

    // 文档位置：集合 notes / 文档 shared
    const noteRef = doc(db, "notes", "shared");

    // 实时监听
    onSnapshot(noteRef, (docSnap) => {
      if (docSnap.exists()) {
        noteEl.value = docSnap.data().content || "";
        statusEl.innerText = "笔记已同步 ✅";
      } else {
        statusEl.innerText = "暂无笔记";
      }
    });

    // 保存
    saveBtn.onclick = async () => {
      await setDoc(noteRef, {
        content: noteEl.value,
        updatedAt: new Date()
      });
      statusEl.innerText = "笔记已保存 ✅";
    };
  </script>
</body>
</html>
