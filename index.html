<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <title>我的同步记事本</title>
  <style>
    body { font-family: sans-serif; padding: 20px; }
    textarea { width: 100%; height: 200px; margin-top: 10px; }
    button { margin: 10px 0; padding: 10px 20px; font-size: 16px; }
    #status { color: red; margin-top: 10px; }
  </style>
</head>
<body>
  <h2>我的同步记事本（需要 Google 登录）</h2>
  <button id="loginBtn">用 Google 登录</button>
  <button id="logoutBtn" style="display:none;">退出登录</button>
  <p id="user"></p>

  <textarea id="note" placeholder="在这里输入你的笔记..."></textarea>
  <button id="saveBtn">保存笔记</button>

  <div id="status"></div>

  <!-- Firebase SDK (兼容版，适合单页 HTML) -->
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore-compat.js"></script>

  <script>
    // 你的 Firebase 配置（去控制台复制出来，注意 storageBucket 后缀要是 appspot.com）
    const firebaseConfig = {
      apiKey: "AIzaSyDzC55TSEVIp6D4VvzuXCTsvWCxH2c4EE4",
      authDomain: "my-sync-notebook.firebaseapp.com",
      projectId: "my-sync-notebook",
      storageBucket: "my-sync-notebook.appspot.com",
      messagingSenderId: "129475590849",
      appId: "1:129475590849:web:c678aa19cad00b9f2ef240"
    };

    // 初始化 Firebase
    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();
    const db = firebase.firestore();

    const loginBtn = document.getElementById("loginBtn");
    const logoutBtn = document.getElementById("logoutBtn");
    const noteEl = document.getElementById("note");
    const saveBtn = document.getElementById("saveBtn");
    const statusEl = document.getElementById("status");
    const userEl = document.getElementById("user");

    let currentUser = null;

    // 登录事件
    loginBtn.onclick = () => {
      const provider = new firebase.auth.GoogleAuthProvider();
      auth.signInWithPopup(provider).catch(err => {
        statusEl.innerText = "Popup 登录失败，改用 Redirect 登录...";
        auth.signInWithRedirect(provider);
      });
    };

    // 登出事件
    logoutBtn.onclick = () => {
      auth.signOut();
    };

    // 监听登录状态
    auth.onAuthStateChanged(user => {
      if (user) {
        currentUser = user;
        loginBtn.style.display = "none";
        logoutBtn.style.display = "inline-block";
        userEl.innerText = "已登录：" + user.email;
        statusEl.innerText = "正在加载笔记...";
        loadNote();
      } else {
        currentUser = null;
        loginBtn.style.display = "inline-block";
        logoutBtn.style.display = "none";
        userEl.innerText = "";
        noteEl.value = "";
        statusEl.innerText = "请先登录。";
      }
    });

    // 保存笔记
    saveBtn.onclick = async () => {
      if (!currentUser) return alert("请先登录！");
      await db.collection("notes").doc(currentUser.uid).set({
        content: noteEl.value,
        updatedAt: firebase.firestore.FieldValue.serverTimestamp()
      });
      statusEl.innerText = "笔记已保存 ✅";
    };

    // 加载笔记
    async function loadNote() {
      if (!currentUser) return;
      const doc = await db.collection("notes").doc(currentUser.uid).get();
      if (doc.exists) {
        noteEl.value = doc.data().content;
        statusEl.innerText = "笔记已加载 ✅";
      } else {
        statusEl.innerText = "没有保存的笔记，请输入后点击保存。";
      }
    }
  </script>
</body>
</html>
